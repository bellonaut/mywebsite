---
import Card from "./Card/index.astro";
import {
  getCurrentTimeInMountain,
  getCurrentTimeInSokoto,
  getCurrentTimeInNewYork,
  formatTimeForMountain,
  formatTimeForSokoto,
  formatTimeForNewYork,
} from "../lib/helpers";
---

<!-- Scaled down: smaller min-height + tighter padding + slightly smaller type -->
<Card
  colSpan="md:col-span-1"
  rowSpan="md:row-span-2"
  height="min-h-[170px] sm:min-h-[190px]"
>
  <div class="tz-wrap flex flex-col gap-2">
    <div class="tz-header">
      <span class="tz-pulse" aria-hidden="true"></span>
    </div>
    <div class="tz-stack flex flex-col gap-2">
      <!-- Edmonton -->
      <div class="tz-row rounded-xl px-3 py-3">
        <div class="flex items-baseline justify-between gap-3">
          <p class="m-0 text-[11px] tracking-wide uppercase tz-label">Edmonton</p>
          <time
            id="tz-mt"
            class="m-0 text-base font-serif tabular-nums whitespace-nowrap tz-time"
            datetime=""
          >
            {formatTimeForMountain(getCurrentTimeInMountain())}
          </time>
        </div>
      </div>

      <!-- Sokoto -->
      <div class="tz-row rounded-xl px-3 py-3">
        <div class="flex items-baseline justify-between gap-3">
          <p class="m-0 text-[11px] tracking-wide uppercase tz-label">Sokoto</p>
          <time
            id="tz-wat"
            class="m-0 text-base font-serif tabular-nums whitespace-nowrap tz-time"
            datetime=""
          >
            {formatTimeForSokoto(getCurrentTimeInSokoto())}
          </time>
        </div>
      </div>

      <!-- New York -->
      <div class="tz-row rounded-xl px-3 py-3">
        <div class="flex items-baseline justify-between gap-3">
          <p class="m-0 text-[11px] tracking-wide uppercase tz-label">New York</p>
          <time
            id="tz-et"
            class="m-0 text-base font-serif tabular-nums whitespace-nowrap tz-time"
            datetime=""
          >
            {formatTimeForNewYork(getCurrentTimeInNewYork())}
          </time>
        </div>
      </div>
    </div>
  </div>
</Card>

<style>
  .tz-header {
    display: flex;
    align-items: center;
    justify-content: flex-end;
    gap: 8px;
    padding: 0 2px;
  }

  .tz-pulse {
    width: 8px;
    height: 8px;
    border-radius: 999px;
    background: rgba(56, 189, 248, 0.7);
    box-shadow: 0 0 12px rgba(56, 189, 248, 0.45);
  }

  /* Blue theme without screaming */
  .tz-row {
    border: 1px solid rgba(200, 200, 200, 0.12);
    background: linear-gradient(
        135deg,
        rgba(255, 255, 255, 0.04),
        rgba(255, 255, 255, 0.015)
      ),
      rgba(10, 10, 10, 0.12);
    box-shadow: 0 10px 22px rgba(0, 0, 0, 0.18);
    transition: transform 0.14s ease, border-color 0.14s ease,
      background 0.14s ease;
  }

  .tz-row:hover {
    transform: translateY(-1px);
    border-color: rgba(240, 240, 240, 0.35);
    background: linear-gradient(
        135deg,
        rgba(255, 255, 255, 0.07),
        rgba(255, 255, 255, 0.03)
      ),
      rgba(10, 10, 10, 0.14);
  }

  .tz-label {
    color: rgba(210, 215, 220, 0.62);
  }

  .tz-time {
    color: rgba(245, 245, 245, 0.92);
    text-shadow: 0 0 16px rgba(255, 255, 255, 0.08);
  }

  @media (prefers-reduced-motion: reduce) {
    .tz-row {
      transition: none;
    }
  }
</style>

<script is:inline>
  const zones = [
    { id: "tz-mt", tz: "America/Edmonton" },
    { id: "tz-wat", tz: "Africa/Lagos" },
    { id: "tz-et", tz: "America/New_York" },
  ];

  const fmt = (tz) => {
    return new Intl.DateTimeFormat("en-US", {
      timeZone: tz,
      hour: "numeric",
      minute: "2-digit",
      hour12: true,
    }).format(new Date());
  };

  function tick() {
    const nowISO = new Date().toISOString();
    for (const z of zones) {
      const el = document.getElementById(z.id);
      if (!el) continue;
      el.textContent = fmt(z.tz);
      el.setAttribute("datetime", nowISO);
    }
  }

  tick();
  setInterval(tick, 1000);
</script>
